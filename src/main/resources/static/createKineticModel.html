<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>创建动力学模型</title>

    <link rel="stylesheet" href="bootstrap4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="time/index.css">

    <link rel="stylesheet" href="css/main.css">

    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="bootstrap4.5.0/js/bootstrap.min.js"></script>
    <script src="bootstrap4.5.0/js/popper.min.js"></script>
    <script src="time/index.js"></script>

    <style>
        .suoimg {
            width: 310px;
            height: 160px;
            padding: 5px;
        }
    </style>
</head>

<body>
<div id="vue_index">
    <!-- M模态框 -->
    <button type="button" class="btn btn-primary modal-button" data-toggle="modal" data-target="#exampleModal"
            style="display: none">
        触发模态框按钮
    </button>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">提 示</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {{alertMessage}}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <div id="main_content">
        <div class="container">
            <div class="row">
                <div class="col-12" style="min-height:500px;">
                    <!--操作-->
                    <h2>{{markGoods.MARK_GOODS_NAME}}-痕迹物品详情</h2>
                    <div class="row">
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">物品名称</span>
                            </div>
                            <input type="text" disabled class="form-control" id="MARK_GOODS_NAME"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.MARK_GOODS_NAME">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">物品类型</span>
                            </div>
                            <input type="text" disabled class="form-control" id="GOODS_TYPE_NAME"
                                   aria-describedby="basic-addon3"
                                   v-model="goodsType.GOODS_TYPE_NAME">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">检材类型</span>
                            </div>
                            <input type="text" disabled class="form-control" id="SAMPLE_MATERIAL_NAME"
                                   aria-describedby="basic-addon3" v-model="sampleMaterial.SAMPLE_MATERIAL_NAME">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">提取方法</span>
                            </div>
                            <input type="text" disabled class="form-control" id="EXTRACT_METHOD_NAME"
                                   aria-describedby="basic-addon3" v-model="extractMethod.EXTRACT_METHOD_NAME">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">物品状态</span>
                            </div>
                            <input type="text" disabled class="form-control" id="MARK_GOODS_STATE"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.MARK_GOODS_STATE">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">提取位置</span>
                            </div>
                            <input type="text" disabled class="form-control" id="EXTRACT_POSITION"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.EXTRACT_POSITION">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">尺寸大小</span>
                            </div>
                            <input type="text" disabled class="form-control" id="MARK_GOODS_SIZE"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.MARK_GOODS_SIZE">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">物质组成</span>
                            </div>
                            <input type="text" disabled class="form-control" id="MATERIAL_FORM"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.MATERIAL_FORM">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">外观特点</span>
                            </div>
                            <input type="text" disabled class="form-control" id="APPEARANCE_CHAR"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.APPEARANCE_CHAR">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">提取时间</span>
                            </div>
                            <el-date-picker v-model="markGoods.EXTRACT_TIME" id="EXTRACT_TIME" type="datetime"
                                            format="yyyy-MM-dd HH:mm:ss" value-format="yyyy-MM-dd HH:mm:ss"
                                            placeholder="选择日期时间">
                            </el-date-picker>
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">提取人</span>
                            </div>
                            <input type="text" disabled class="form-control" id="EXTRACT_PERSON"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.EXTRACT_PERSON">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">创建时间</span>
                            </div>
                            <el-date-picker v-model="markGoods.CREATE_TIME" id="CREATE_TIME" type="datetime"
                                            format="yyyy-MM-dd HH:mm:ss" value-format="yyyy-MM-dd HH:mm:ss"
                                            placeholder="选择日期时间">
                            </el-date-picker>
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">鉴定状态</span>
                            </div>
                            <input type="text" disabled class="form-control" id="TEST_STATE"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.TEST_STATE">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">数据来源</span>
                            </div>
                            <input type="text" disabled class="form-control" id="DATA_SOURCES"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.DATA_SOURCES">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">提取数量</span>
                            </div>
                            <input type="text" disabled class="form-control" id="EXTRACT_NUMBER"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.EXTRACT_NUMBER">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">描述</span>
                            </div>
                            <input type="text" disabled class="form-control" id="MARK_GOODS_DESCRIBE"
                                   aria-describedby="basic-addon3" v-model="markGoods.MARK_GOODS_DESCRIBE">
                        </div>
                        <div class="input-group col-md-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">形成方式</span>
                            </div>
                            <input type="text" disabled class="form-control" id="WAY_OF_FOR"
                                   aria-describedby="basic-addon3"
                                   v-model="markGoods.WAY_OF_FOR">
                        </div>
                        <div class="input-btn col-md-12" style="display: flex;justify-content: center;
              padding: 10px;">
                            <button type="button col-md-5" @click="btnClick" class="btnmy"
                                    style="margin-right: 30px;">编辑
                            </button>
                            <button type="button col-md-7" @click="btn2Click" class="btnmy">保存</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="config/config.js"></script>
<script>
    var vm = new Vue({
        el: '#vue_index',
        data: {
            alertMessage: "",
            markGoodsId: "",
            extractMethod: {},
            goodsType: {},
            markGoods: {},
            sampleMaterial: {},
            fullPhoto: [],
            positionPhoto: [],
            markGoodsTestInfo: [],
            involvedPersonInfo: {},
            count: 0
        },
        mounted() {
            this.init();
            console.log(this.markGoods);
        },
        watch: {
            // 进行深度监听
            markGoods: {
                deep: true,
                //使用handler来处理变化
                handler(newVal) {
                    //这个newVal就是监听的对象更新后的值
                    console.log("我变化了", newVal);
                    this.markGoods = newVal
                }
            }
        },
        methods: {
            init() {
                // 获取指定参数值
                this.markGoodsId = '2c91facc6ece8724016ece88153b0004';//this.getUrlParam('KSETID');
                if (this.markGoodsId == "") {
                    this.alertMessage = "参数错误";
                    $(".modal-button").click();
                } else {
                    let params = {
                        markGoodsId: this.markGoodsId
                    }
                    axios.post(base_ip + "/wuzhengB/select/createKineticModel", params).then((response) => {
                        console.log(response.data.data)
                        if (response.data.code == '200') {
                            this.extractMethod = response.data.data.extractMethod == null ? {} : response.data.data.extractMethod;
                            this.goodsType = response.data.data.goodsType == null ? {} : response.data.data.goodsType;
                            this.markGoods = response.data.data.markGoods == null ? {} : response.data.data.markGoods;
                            this.sampleMaterial = response.data.data.sampleMaterial == null ? {} : response.data.data.sampleMaterial;
                            this.fullPhoto = response.data.data.fullPhoto;
                            this.positionPhoto = response.data.data.positionPhoto;
                            this.markGoodsTestInfo = response.data.data.markGoodsTestInfo;
                        } else {
                            this.alertMessage = response.data.code.message;
                            $(".modal-button").click();
                        }
                    })
                }
            },
            getUrlParam(name) {
                // 取得url中?后面的字符
                var query = window.location.search.substring(1);
                // 把参数按&拆分成数组
                var param_arr = query.split("&");
                for (var i = 0; i < param_arr.length; i++) {
                    var pair = param_arr[i].split("=");
                    if (pair[0] == name) {
                        return pair[1];
                    }
                }
                return "";
            },
            personDetail(ilp) {
                this.involvedPersonInfo = ilp
                $(".person-button").click()
            },
            showImg(base64str) {
                $("#ShowImage_Form").find("#img_show").html("<image src='" + "data:image/png;base64," + base64str + "'/>");
                $("#ShowImage_Form").modal();
            },
            btnClick() {
                $('.input-group input').attr('disabled', false)
            },
            btn2Click() {
                this.markGoods.tableName = "MARK_GOODS";
                this.markGoods.tableId = "MARK_GOODS_ID";
                axios.post(base_ip + "/wuzhengB/update", this.markGoods).then((response) => {
                    if (response.data.code == '200') {

                    } else {
                        this.alertMessage = response.data.code.message;
                        $(".modal-button").click();
                    }
                })
                $('.input-group input').attr('disabled', true)
            },
            td_btnClick(mgti, e) {
                console.log(mgti);
                let that = $(this)
                if (e.target.innerText == '编辑') {
                    $('table td button').text('保存')
                    $('table td button').attr('class', 'btnmy')
                    $('table tr input').attr('disabled', false)
                } else {
                    $('table td button').text('编辑')
                    $('table td button').attr('class', 'btnmy')
                    $('table tr input').attr('disabled', true)
                    let param = {
                        INSPECTION_NUMBER: mgti.INSPECTION_NUMBER,
                        APPRAISAL_CONCLUSION: mgti.APPRAISAL_CONCLUSION,
                        MARK_GOODS_TEST_INFO_ID: mgti.MARK_GOODS_TEST_INFO_ID,
                        tableName: "MARK_GOODS_TEST_INFO",
                        tableId: "MARK_GOODS_TEST_INFO_ID"
                    }
                    axios.post(base_ip + "/wuzhengB/update", param).then((response) => {
                        if (response.data.code == '200') {

                        } else {
                            this.alertMessage = response.data.code.message;
                            $(".modal-button").click();
                        }
                    })


                }
                $(this).parent().siblings("td").each(function () {  // 获取当前行的其他单元格
                        var obj_text = $(this).find("input:text");    // 判断单元格下是否有文本框
                        if (!obj_text.length) {

                        }  // 如果没有文本框，则添加文本框使之可以编辑
                    },
                    modelBtnClick()
                {
                    $('.modal-body input').attr('disabled', false)
                }
            ,
                modelBtn2Click()
                {
                    this.involvedPersonInfo.tableName = "INVOLVED_PERSON_INFO";
                    this.involvedPersonInfo.tableId = "INVOLVED_PERSON_INFO_ID";
                    axios.post(base_ip + "/wuzhengB/update", this.involvedPersonInfo).then((response) => {
                        if (response.data.code == '200') {

                        } else {
                            this.alertMessage = response.data.code.message;
                            $(".modal-button").click();
                        }
                    })
                    $('.modal-body input').attr('disabled', true)
                }
            }
        })

</script>
</body>

</html>
